<!doctype html><html lang=en-us><head><title>your database connection deserves a name - Andy Grunwald</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Andy Grunwald"><meta name=description content="Assigning a name to your database connection can lower your time to debug. We provide an overview of how to do this for various database systems and programming languages."><meta name=keywords content="Database,Lessons learned,Engineering,Programming,PHP,Go,Python,Redis,RabbitMQ,PostgreSQL,MySQL,MSSQL,SQL-Server,Nats,Oracle,MongoDB,HTTP,Best practice"><meta property="og:title" content="your database connection deserves a name"><meta property="og:description" content="Assigning a name to your database connection can lower your time to debug. We provide an overview of how to do this for various database systems and programming languages."><meta property="og:type" content="article"><meta property="og:url" content="https://andygrunwald.com/blog/your-database-connection-deserves-a-name/"><meta property="og:image" content="https://andygrunwald.com/img/posts/your-database-connection-deserves-a-name/assign-a-name-to-your-connection.png"><meta property="og:image" content="https://andygrunwald.com/img/posts/your-database-connection-deserves-a-name/perfect-engineering-world-vs-reality-shared-database.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-07-25T08:30:00+02:00"><meta property="article:modified_time" content="2021-08-20T18:25:00+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://andygrunwald.com/img/posts/your-database-connection-deserves-a-name/assign-a-name-to-your-connection.png"><meta name=twitter:title content="your database connection deserves a name"><meta name=twitter:description content="Assigning a name to your database connection can lower your time to debug. We provide an overview of how to do this for various database systems and programming languages."><meta name=twitter:site content="@andygrunwald"><meta name=twitter:creator content="@andygrunwald"><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><link rel=canonical href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/><link rel=stylesheet href=https://andygrunwald.com/css/main.css><link rel="shortcut icon" type=image/x-icon href=https://andygrunwald.com/favicon.ico><link rel=apple-touch-icon sizes=57x57 href=https://andygrunwald.com/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://andygrunwald.com/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://andygrunwald.com/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://andygrunwald.com/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://andygrunwald.com/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://andygrunwald.com/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://andygrunwald.com/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://andygrunwald.com/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=https://andygrunwald.com/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=https://andygrunwald.com/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=https://andygrunwald.com/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=https://andygrunwald.com/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=https://andygrunwald.com/favicon-16x16.png><link rel=manifest href=https://andygrunwald.com/site.webmanifest><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="https://andygrunwald.com/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/solid.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/brands.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/fontawesome.min.css><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel=stylesheet type=text/css></head><body><header class=site-header><div class=branding><a href=https://andygrunwald.com/><img class=avatar src=https://andygrunwald.com/img/avatar.png alt=avatar></a><h1 class=site-title><a href=https://andygrunwald.com/>Andy Grunwald</a></h1></div><nav class=site-nav><ul><li><a href=https://andygrunwald.com/>Blog</a></li><li><a href=https://andygrunwald.com/about/>About</a></li><li class=icon><a href=https://andygrunwald.com/index.xml title=Subcribe><i class="fas fa-fw fa-rss"></i></a></li><li class=icon><a href=mailto:andygrunwald@gmail.com title=Email><i class="fas fa-fw fa-envelope"></i></a></li><li class=icon><a href=https://github.com/andygrunwald rel=me title=GitHub><i class="fab fa-fw fa-github"></i></a></li><li class=icon><a href=https://www.linkedin.com/in/andy-grunwald-09aa265a rel=me title=LinkedIn><i class="fab fa-fw fa-linkedin"></i></a></li><li class=icon><a href=https://twitter.com/andygrunwald rel=me title=Twitter><i class="fab fa-fw fa-twitter"></i></a></li><li class=icon><a href=https://meetup.com/Web-Engineering-Duesseldorf/ rel=me title=Meetup><i class="fab fa-fw fa-meetup"></i></a></li></ul></nav></header><div class=content><article><header><h1 class=title>your database connection deserves a name</h1><p class=meta>July 25, 2021 &#183; 8 minute read
&#183; Tags:
<a href=https://andygrunwald.com/tags/engineering/>Engineering</a>
, <a href=https://andygrunwald.com/tags/lessons-learned/>Lessons learned</a>
, <a href=https://andygrunwald.com/tags/programming/>Programming</a></p></header><section class=post-content><figure><img src=https://andygrunwald.com/img/posts/your-database-connection-deserves-a-name/assign-a-name-to-your-connection.png alt="Provide a name to your database connection"></figure><p><strong>tl;dr</strong>:
In my last eight years working mainly on the scalability and reliability of <a href=https://www.trivago.com/>trivago</a>, I was involved in many outages where overloaded databases have been the root cause.
Debugging these incidents is often not straightforward,
primarily when multiple apps interact with the same database.
<strong>Assigning a name to each database connection</strong> make a difference here.
It will reduce the time to debug by multiple hours and finding the root cause faster.
From the perspective of the database, you can differentiate the apps and their commands to identify the bad client.</p><p>➡️ Want to see how it works? Checkout examples for
<a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_mongodb_-connection>MongoDB</a>, <a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_mssql--sql-server_-connection>MSSQL / SQL-Server</a>, <a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_mysql_-connection>MySQL</a>, <a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_nats_-connection>NATS</a>, <a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_oracle_-connection>Oracle database</a>, <a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_postgresql_-connection>PostgreSQL</a>, <a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_redis_-connection>redis</a>, and non-database systems like <a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_rabbitmq_-connection>RabbitMQ</a> or <a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_http_-connection>HTTP</a>.</p><h2 id=why-does-naming-your-database-connection-make-sense>Why does naming your database connection make sense?</h2><p>Many of the applications on this planet interact with some kind of database.
In a perfect world:</p><ul><li>Every application has its own database</li><li>Several applications do not share the same database</li><li>Direct access to the stored data is shielded by an application via an API</li></ul><p>The thing is: We don&rsquo;t live in a perfect world.
The reality often is:</p><ul><li>Several applications share one or multiple databases</li><li>These applications are developed independently</li><li>and receive different types of traffic patterns</li></ul><p>This may lead to a situation where one application requests many compute resources from the database by inefficient queries.
At the same time, other applications might suffer from unexpected behavior or a partial outage due to limited resources available on the database to serve the requests.</p><figure><img src=https://andygrunwald.com/img/posts/your-database-connection-deserves-a-name/perfect-engineering-world-vs-reality-shared-database.png alt="A perfect world where everyone has its own database vs. Reality where databases are shared."><figcaption><p>A perfect world where everyone has its own database vs. Reality where databases are shared.</p></figcaption></figure><p>This situation is typically hard to debug because the root cause is not that obvious:
Application B is failing because the database cannot answer in time due to Application A sending expensive queries.</p><p>In my last eight years working mainly on the scalability and reliability of <a href=https://www.trivago.com/>trivago</a>, I have seen many outages that contained similar things like:</p><ul><li><a href=https://tech.trivago.com/2017/01/25/learn-redis-the-hard-way-in-production/ title="Learn Redis the hard way (in production) @ trivago tech blog">blocked and unresponsive Redis instances</a></li><li>blocked database tables due to inefficient queries</li><li>overloaded database servers due to raising traffic and query volumes</li><li>services that receive a large number of HTTP requests from unknown sources</li></ul><p>In all cases, identifying the client responsible for the trouble was the main entry point for the final solution.
<strong>Connection naming has helped us multiple times during an incident to find the root cause faster</strong>.</p><p>Assigning a name to each client database connection can help to</p><ul><li>lower the debugging pain and reduce the time to recover in an outage</li><li>implement rate limiting per connection name</li><li>collect usage/resource metrics from the perspective of the database over each application</li></ul><p>Furthermore, it is beneficial if you plan to <strong>deprecate and shut down a &ldquo;legacy&rdquo; application that still receives traffic</strong>.
Identifying all clients can help you achieve your goal quicker.
In this case, the alternatives to connection naming would be:</p><ul><li>Asking around &ldquo;<em>Who is using the old currency conversion service?</em>&rdquo; in the company chat</li><li>Shutting down the service and wait until other applications crash or people start to scream why something is not working as expected</li></ul><p>Both alternatives can be professionally solved with connection naming.</p><h2 id=what-is-a-good-connection-name>What is a good connection name?</h2><p>In general, everything to identify the client application that sends the request or query.
Two quick suggestions:</p><p><strong>If you control all applications and databases</strong>, choose the name of the application itself.
If the application opens several connections, add another identifier like a package or a class name.
Like <code>currency-conversion-app</code> or <code>stock-exchange-rate-importer</code>.</p><p><strong>If you don&rsquo;t own the database or operate the external service</strong>, use the application name followed by some contact information.
Like <code>currency-conversion - currency@mycompany.com</code>.
In case of trouble, the administrator can reach out.</p><h2 id=how-to-assign-a-name-to-a-database-connection>How to assign a name to a database connection</h2><p>This is different for each system.
Below you find instructions for</p><ul><li><a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_mongodb_-connection>MongoDB</a></li><li><a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_mssql--sql-server_-connection>MSSQL / SQL-Server</a></li><li><a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_mysql_-connection>MySQL</a></li><li><a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_oracle_-connection>Oracle database</a></li><li><a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_postgresql_-connection>PostgreSQL</a></li><li><a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_redis_-connection>redis</a></li></ul><p>Non-database systems like Message Queues or HTTP based APIs also support connection naming:</p><ul><li><a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_nats_-connection>NATS</a></li><li><a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_rabbitmq_-connection>RabbitMQ</a></li><li><a href=https://andygrunwald.com/blog/your-database-connection-deserves-a-name/#how-to-assign-a-name-to-your-_http_-connection>HTTP</a></li></ul><p>Keep in mind: <strong>Not every database supports connection naming</strong>.
In such cases, often there are <strong>workarounds</strong>.
For systems that support user authentication, using separate user accounts for each application can have a similar effect.</p><p>Once <strong>connection naming is supported</strong>, it is usually <strong>straightforward to implement without any engineering overhead</strong>.</p><p>In <a href=https://github.com/andygrunwald/your-connection-deserves-a-name title="Code examples on how to name a connection for Redis, RabbitMQ, PostgreSQL and more">andygrunwald/your-connection-deserves-a-name @ Github</a> I provide complete examples for different programming languages and systems on how to assign a name to a connection.</p><h3 id=how-to-assign-a-name-to-your-_mongodb_-connection>How to assign a name to your <em>MongoDB</em> connection</h3><p>While creating a connection to <a href=https://www.mongodb.com/>MongoDB</a>, you can provide an <a href=https://docs.mongodb.com/manual/reference/connection-string/#mongodb-urioption-urioption.appName><code>appName</code></a> in the connection string.</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>dsn <span style=color:#666>:=</span> <span style=color:#4070a0>&#34;mongodb://root:secret@127.0.0.1:27017/?appName=currency-conversion-app&#34;</span>
client, err <span style=color:#666>:=</span> mongo.<span style=color:#06287e>Connect</span>(ctx, options.<span style=color:#06287e>Client</span>().<span style=color:#06287e>ApplyURI</span>(dsn))
</code></pre></div><p>To see which clients are connected, you can query <a href=https://docs.mongodb.com/manual/reference/method/db.currentOp/><code>db.currentOp()</code></a>:</p><figure><img src=https://andygrunwald.com/img/posts/your-database-connection-deserves-a-name/mongodb-db.currentOp-result.png alt="MongoDB: Output of db.currentOp() including the `appName` setting"><figcaption><p>MongoDB: Output of db.currentOp() including the <code>appName</code> setting</p></figcaption></figure><p>or check the server logs:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#062873;font-weight:700>&#34;t&#34;</span>: {
        <span style=color:#062873;font-weight:700>&#34;$date&#34;</span>: <span style=color:#4070a0>&#34;2021-07-30T16:30:18.042+00:00&#34;</span>
    },
    <span style=color:#062873;font-weight:700>&#34;attr&#34;</span>: {
            <span style=color:#062873;font-weight:700>&#34;application&#34;</span>: {
                <span style=color:#062873;font-weight:700>&#34;name&#34;</span>: <span style=color:#4070a0>&#34;currency-conversion-app&#34;</span>
            }
        }
    }
<span>}</span>
</code></pre></div><p>➡️ Checkout <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/tree/main/mongodb>screenshots and code examples for MongoDB at Github</a>.</p><p>🙏 Thanks to <a href=https://twitter.com/alcaeus>Andreas Braun</a>, who pointed me to this feature in MongoDB.</p><h3 id=how-to-assign-a-name-to-your-_mssql--sql-server_-connection>How to assign a name to your <em>MSSQL / SQL-Server</em> connection</h3><p>While creating a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.data.sqlclient.sqlconnection.connectionstring?view=dotnet-plat-ext-5.0">connection to SQL-Server, you can set an <code>Application Name</code></a>.
This is (mostly) part of the data source name (dsn)/connection string.</p><p>Here is an example in Go:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>query <span style=color:#666>:=</span> url.Values{}
query.<span style=color:#06287e>Add</span>(<span style=color:#4070a0>&#34;app name&#34;</span>, <span style=color:#4070a0>&#34;currency-conversion-app&#34;</span>)

u <span style=color:#666>:=</span> <span style=color:#666>&amp;</span>url.URL{
    Scheme:   <span style=color:#4070a0>&#34;sqlserver&#34;</span>,
    User:     url.<span style=color:#06287e>UserPassword</span>(<span style=color:#4070a0>&#34;sa&#34;</span>, <span style=color:#4070a0>&#34;yourStrong(!)Password&#34;</span>),
    Host:     fmt.<span style=color:#06287e>Sprintf</span>(<span style=color:#4070a0>&#34;%s:%d&#34;</span>, <span style=color:#4070a0>&#34;127.0.0.1&#34;</span>, <span style=color:#40a070>1433</span>),
    Path:     <span style=color:#4070a0>&#34;/&#34;</span>,
    RawQuery: query.<span style=color:#06287e>Encode</span>(),
}
dsn <span style=color:#666>:=</span> u.<span style=color:#06287e>String</span>()

client, err <span style=color:#666>:=</span> sql.<span style=color:#06287e>Open</span>(<span style=color:#4070a0>&#34;sqlserver&#34;</span>, dsn)
</code></pre></div><p>To see which clients are connected (incl. their application name), you can query the <code>sys.sysprocesses</code> table:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#007020;font-weight:700>SELECT</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>hostname,<span style=color:#bbb>
</span><span style=color:#bbb>    </span>program_name,<span style=color:#bbb>
</span><span style=color:#bbb>    </span>loginame,<span style=color:#bbb>
</span><span style=color:#bbb>    </span>cmd<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#007020;font-weight:700>FROM</span><span style=color:#bbb> </span>sys.sysprocesses<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#007020;font-weight:700>WHERE</span><span style=color:#bbb> </span>program_name<span style=color:#bbb> </span><span style=color:#666>!=</span><span style=color:#bbb> </span><span>\</span><span style=color:#4070a0>&#34;\&#34;</span>;<span style=color:#bbb>
</span></code></pre></div><p>The result should look similar to:</p><pre><code>hostname       program_name                  loginame       cmd
-------------- ----------------------------- -------------- ----------------------
lap-dev        currency-conversion-app       sa             AWAITING COMMAND
</code></pre><p>➡️ Checkout <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/tree/main/mssql>the code examples for MSSQL / SQL-Server at Github</a>.</p><h3 id=how-to-assign-a-name-to-your-_mysql_-connection>How to assign a name to your <em>MySQL</em> connection</h3><p>While creating a <a href=https://dev.mysql.com/doc/refman/8.0/en/performance-schema-connection-attribute-tables.html>connection to MySQL, you can set connection attributes</a>.
Depending on the client library, this is either part of the data source name (DSN) or provided via a function call (mostly setting a kind of <code>set_option</code>).</p><p>For the application name, the connection attribute <code>program_name</code> is suggested.
Applications like <a href=https://github.com/sysown/proxysql/blob/5ede60ec9fb4217095fcf792c07cc515c195ea5f/lib/mysql_connection.cpp#L633>ProxySQL</a> and <a href=https://github.com/mysql/mysql-workbench/blob/5e10b42aa539155128bd97d54ed2cdd7ca283b34/plugins/migration/copytable/copytable.cpp#L1799>MySQL Workbench</a> using the same feature to identify themselves against the MySQL server.</p><p>Here is an example in Python with the <a href=https://pypi.org/project/PyMySQL/>PyMySQL library</a>:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>client <span style=color:#666>=</span> pymysql<span style=color:#666>.</span>connect(
                host<span style=color:#666>=</span><span style=color:#4070a0>&#39;127.0.0.1&#39;</span>,
                user<span style=color:#666>=</span><span style=color:#4070a0>&#39;root&#39;</span>,
                password<span style=color:#666>=</span><span style=color:#4070a0>&#39;secret&#39;</span>,
                database<span style=color:#666>=</span><span style=color:#4070a0>&#39;dummy&#39;</span>,
                charset<span style=color:#666>=</span><span style=color:#4070a0>&#39;utf8mb4&#39;</span>,
                cursorclass<span style=color:#666>=</span>pymysql<span style=color:#666>.</span>cursors<span style=color:#666>.</span>DictCursor,
                program_name<span style=color:#666>=</span><span style=color:#4070a0>&#39;unit-conversion-app&#39;</span>,
            )
</code></pre></div><p>To see which clients are connected, you can query the <a href=https://dev.mysql.com/doc/refman/8.0/en/performance-schema.html><code>performance_schema</code></a> and <a href=https://dev.mysql.com/doc/refman/8.0/en/information-schema.html><code>information_schema</code></a> schema:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#007020;font-weight:700>SELECT</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>session_connect_attrs.ATTR_VALUE<span style=color:#bbb> </span><span style=color:#007020;font-weight:700>AS</span><span style=color:#bbb> </span>program_name,<span style=color:#bbb>
</span><span style=color:#bbb>    </span>processlist.<span style=color:#666>*</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#007020;font-weight:700>FROM</span><span style=color:#bbb> </span>information_schema.processlist<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#007020;font-weight:700>LEFT</span><span style=color:#bbb> </span><span style=color:#007020;font-weight:700>JOIN</span><span style=color:#bbb> </span>performance_schema.session_connect_attrs<span style=color:#bbb> </span><span style=color:#007020;font-weight:700>ON</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span><span style=color:#bbb>    </span>processlist.ID<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>session_connect_attrs.PROCESSLIST_ID<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#007020;font-weight:700>AND</span><span style=color:#bbb> </span>session_connect_attrs.ATTR_NAME<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#4070a0>&#34;program_name&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb></span>)<span style=color:#bbb>
</span></code></pre></div><p>The result should look similar to:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>program_name<span style=color:#bbb>        </span><span style=color:#666>|</span><span style=color:#bbb> </span>ID<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#007020;font-weight:700>USER</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#007020;font-weight:700>HOST</span><span style=color:#bbb>             </span><span style=color:#666>|</span><span style=color:#bbb> </span>DB<span style=color:#bbb>    </span><span style=color:#666>|</span><span style=color:#bbb> </span>[...]<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#60a0b0;font-style:italic>--------------------+----+------+------------------+-------+------
</span><span style=color:#60a0b0;font-style:italic></span>unit<span style=color:#666>-</span><span style=color:#007020;font-weight:700>conversion</span><span style=color:#666>-</span>app<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#40a070>11</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>root<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#40a070>172</span>.<span style=color:#40a070>17</span>.<span style=color:#40a070>0</span>.<span style=color:#40a070>1</span>:<span style=color:#40a070>56382</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>dummy<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>[...]<span style=color:#bbb>
</span></code></pre></div><p>➡️ Checkout <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/tree/main/mysql>screenshots and code examples for MySQL at Github</a>.</p><p>🙏 Thanks to <a href=https://twitter.com/johannescode>Johannes Schlüter</a>, who pointed me to this feature in MySQL.</p><p>PS: This feature was added in <a href=https://dev.mysql.com/doc/relnotes/mysql/5.6/en/news-5-6-6.html>MySQL v5.6.6 (2012-08-07)</a>.</p><h3 id=how-to-assign-a-name-to-your-_oracle_-connection>How to assign a name to your <em>Oracle</em> connection</h3><p>While executing a query on the Oracle database, you can provide a client name (and other client information) as additional query information.
This is called <a href=https://docs.oracle.com/en/database/oracle/oracle-database/18/arpls/DBMS_APPLICATION_INFO.html#GUID-14484F86-44F2-4B34-B34E-0C873D323EAD><code>DBMS_APPLICATION_INFO</code></a>.</p><p>Here is an example of how it works in Go (using <a href=https://github.com/godror/godror>godror/godror</a>):</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#60a0b0;font-style:italic>// Creating a connection to the oracle database
</span><span style=color:#60a0b0;font-style:italic></span>[<span style=color:#666>...</span>]

<span style=color:#60a0b0;font-style:italic>// Adding DBMS_APPLICATION_INFO
</span><span style=color:#60a0b0;font-style:italic></span>ctx <span style=color:#666>:=</span> godror.<span style=color:#06287e>ContextWithTraceTag</span>(context.<span style=color:#06287e>Background</span>(), godror.TraceTag{
    ClientIdentifier: <span style=color:#4070a0>&#34;currency-conversion-app&#34;</span>,
    ClientInfo:       <span style=color:#4070a0>&#34;Demo showcase&#34;</span>,
    DbOp:             <span style=color:#4070a0>&#34;ping&#34;</span>,
    Module:           <span style=color:#4070a0>&#34;oracle/go&#34;</span>,
    Action:           <span style=color:#4070a0>&#34;main&#34;</span>,
})

<span style=color:#60a0b0;font-style:italic>// Sending DBMS_APPLICATION_INFO
</span><span style=color:#60a0b0;font-style:italic></span>rows, err <span style=color:#666>:=</span> client.<span style=color:#06287e>QueryContext</span>(ctx, <span style=color:#4070a0>&#34;SELECT sysdate FROM dual&#34;</span>)
</code></pre></div><p>To see which clients are connected (incl. client information) and executed query statements, you can ask the <code>v$session</code> and <code>v$sqlarea</code> tables:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#007020;font-weight:700>SQL</span><span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#007020;font-weight:700>SELECT</span><span style=color:#bbb> </span>sess.username,<span style=color:#bbb> </span>sess.client_identifier,<span style=color:#bbb> </span>sess.module,<span style=color:#bbb> </span>sess.action,<span style=color:#bbb> </span>area.sql_text<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#007020;font-weight:700>FROM</span><span style=color:#bbb> </span>v$session<span style=color:#bbb> </span>sess,<span style=color:#bbb> </span>v$sqlarea<span style=color:#bbb> </span>area<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#007020;font-weight:700>WHERE</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>sess.sql_address<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>area.address<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#007020;font-weight:700>AND</span><span style=color:#bbb> </span>sess.username<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#4070a0>&#39;DEMO&#39;</span>;<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span>USERNAME<span style=color:#bbb>        </span>CLIENT_IDENTIFIER<span style=color:#bbb>         </span>MODULE<span style=color:#bbb>          </span>ACTION<span style=color:#bbb>          </span>SQL_TEXT<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#60a0b0;font-style:italic>--------------- ------------------------- --------------- --------------- ---------------------------
</span><span style=color:#60a0b0;font-style:italic></span>DEMO<span style=color:#bbb>            </span>currency<span style=color:#666>-</span><span style=color:#007020;font-weight:700>conversion</span><span style=color:#666>-</span>app<span style=color:#bbb>   </span>oracle<span style=color:#666>/</span><span style=color:#007020;font-weight:700>go</span><span style=color:#bbb>       </span>main<span style=color:#bbb>            </span><span style=color:#007020;font-weight:700>SELECT</span><span style=color:#bbb> </span>sysdate<span style=color:#bbb> </span><span style=color:#007020;font-weight:700>FROM</span><span style=color:#bbb> </span>dual<span style=color:#bbb>
</span></code></pre></div><p>➡️ Checkout <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/tree/main/oracle>code examples for Oracle at Github</a>.</p><p>🙏 Thanks to <a href=https://twitter.com/GeraldVenzl>Gerald Venzl</a>, who pointed me in the right direction with his information.</p><h3 id=how-to-assign-a-name-to-your-_postgresql_-connection>How to assign a name to your <em>PostgreSQL</em> connection</h3><p>While creating a connection to <a href=https://www.postgresql.org/>PostgreSQL</a>, you can provide a <a href=https://www.postgresql.org/docs/9.0/runtime-config-logging.html#GUC-APPLICATION-NAME><code>application_name</code></a> in the data source name (DSN):</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>dsn <span style=color:#666>:=</span> <span style=color:#4070a0>&#34;postgres://user:pass@127.0.0.1/database?application_name=currency-conversion-app&#34;</span>
client, err <span style=color:#666>:=</span> sql.<span style=color:#06287e>Open</span>(<span style=color:#4070a0>&#34;postgres&#34;</span>, dsn)
</code></pre></div><p>To see which clients are connected with their application name, you can query the <a href=https://www.postgresql.org/docs/9.2/monitoring-stats.html><code>pg_stat_activity</code></a> table:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>postgres<span style=color:#666>=#</span><span style=color:#bbb> </span><span style=color:#007020;font-weight:700>SELECT</span><span style=color:#bbb> </span>usename,<span style=color:#bbb> </span>application_name,<span style=color:#bbb> </span>client_addr,<span style=color:#bbb> </span>backend_type<span style=color:#bbb> </span><span style=color:#007020;font-weight:700>FROM</span><span style=color:#bbb> </span>pg_stat_activity;<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb> </span>usename<span style=color:#bbb>  </span><span style=color:#666>|</span><span style=color:#bbb>     </span>application_name<span style=color:#bbb>     </span><span style=color:#666>|</span><span style=color:#bbb> </span>client_addr<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb>  </span>backend_type<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#60a0b0;font-style:italic>----------+--------------------------+-------------+-----------------
</span><span style=color:#60a0b0;font-style:italic></span><span style=color:#bbb> </span>postgres<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>stock<span style=color:#666>-</span>exchange<span style=color:#666>-</span>rates<span style=color:#666>-</span>app<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#40a070>172</span>.<span style=color:#40a070>17</span>.<span style=color:#40a070>0</span>.<span style=color:#40a070>1</span><span style=color:#bbb>  </span><span style=color:#666>|</span><span style=color:#bbb> </span>client<span style=color:#bbb> </span>backend<span style=color:#bbb>
</span><span style=color:#bbb> </span>postgres<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>currency<span style=color:#666>-</span><span style=color:#007020;font-weight:700>conversion</span><span style=color:#666>-</span>app<span style=color:#bbb>  </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#40a070>172</span>.<span style=color:#40a070>17</span>.<span style=color:#40a070>0</span>.<span style=color:#40a070>1</span><span style=color:#bbb>  </span><span style=color:#666>|</span><span style=color:#bbb> </span>client<span style=color:#bbb> </span>backend<span style=color:#bbb>
</span></code></pre></div><p>➡️ Checkout <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/tree/main/postgresql>screenshots and code examples for PostgreSQL at Github</a>.</p><h3 id=how-to-assign-a-name-to-your-_redis_-connection>How to assign a name to your <em>redis</em> connection</h3><p>After creating a connection to <a href=https://redis.io/>redis</a>, send the <a href=https://redis.io/commands/client-setname title="CLIENT SETNAME @ redis docs"><code>CLIENT SETNAME</code></a> command:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>CLIENT SETNAME currency-conversion-app
</code></pre></div><p>Via <a href=https://redis.io/commands/client-list title="CLIENT LIST @ redis docs"><code>CLIENT LIST</code></a> you can see all clients, including their name:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ CLIENT LIST
<span style=color:#bb60d5>id</span><span style=color:#666>=</span><span style=color:#40a070>3</span> <span style=color:#bb60d5>addr</span><span style=color:#666>=</span>172.17.0.1:62668 <span style=color:#bb60d5>name</span><span style=color:#666>=</span>currency-conversion-app <span style=color:#666>[</span>...<span style=color:#666>]</span>
<span style=color:#bb60d5>id</span><span style=color:#666>=</span><span style=color:#40a070>4</span> <span style=color:#bb60d5>addr</span><span style=color:#666>=</span>172.17.0.1:62676 <span style=color:#bb60d5>name</span><span style=color:#666>=</span>stock-exchange-rates-app <span style=color:#666>[</span>...<span style=color:#666>]</span>
</code></pre></div><p>➡️ Checkout <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/tree/main/redis>screenshots and code examples for redis at Github</a>.</p><h3 id=how-to-assign-a-name-to-your-_nats_-connection>How to assign a name to your <em>NATS</em> connection</h3><p>While creating a connection to <a href=https://nats.io/>NATS</a>, you can provide <a href=https://docs.nats.io/developing-with-nats/connecting/name title="Connection Name @ NATS docs">client connection name</a>.</p><p>This is how it looks like in Go:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>client, err <span style=color:#666>:=</span> nats.<span style=color:#06287e>Connect</span>(<span style=color:#4070a0>&#34;nats://127.0.0.1:4222&#34;</span>, nats.<span style=color:#06287e>Name</span>(<span style=color:#4070a0>&#34;currency-conversion-app&#34;</span>))
</code></pre></div><p>Via the <a href=https://docs.nats.io/running-a-nats-service/nats_admin title="Monitoring endpoint @ NATS docs">NATS monitoring endpoint</a>, you can see all connected clients, including their names:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span>$</span> <span>curl</span> <span>http://</span><span style=color:#40a070>127.0</span><span>.</span><span style=color:#40a070>0.1</span><span>:</span><span style=color:#40a070>8222</span><span>/connz</span>
{
  <span>[...]</span>
  <span style=color:#062873;font-weight:700>&#34;connections&#34;</span>: [
    {
      <span style=color:#062873;font-weight:700>&#34;ip&#34;</span>: <span style=color:#4070a0>&#34;172.17.0.1&#34;</span>,
      <span style=color:#062873;font-weight:700>&#34;port&#34;</span>: <span style=color:#40a070>57054</span>,
      <span>[...]</span>
      <span style=color:#062873;font-weight:700>&#34;name&#34;</span>: <span style=color:#4070a0>&#34;currency-conversion-app&#34;</span>,
      <span style=color:#062873;font-weight:700>&#34;lang&#34;</span>: <span style=color:#4070a0>&#34;go&#34;</span>,
      <span style=color:#062873;font-weight:700>&#34;version&#34;</span>: <span style=color:#4070a0>&#34;1.11.0&#34;</span>
    }
  ]
}
</code></pre></div><p>➡️ Checkout <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/tree/main/nats>screenshots and code examples for NATS at Github</a>.</p><p>🙏 Thanks to <a href=https://twitter.com/wallyqs>Waldemar Quevedo</a>, who integrated NATS <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/pull/2>via Pull Request</a>.</p><h3 id=how-to-assign-a-name-to-your-_rabbitmq_-connection>How to assign a name to your <em>RabbitMQ</em> connection</h3><p>While creating a connection to <a href=https://www.rabbitmq.com/>RabbitMQ</a>, you can provide AMQP options.
One of the options is <a href=https://www.rabbitmq.com/connections.html#client-provided-names title="AMQP Client-Provided Connection Name @ RabbitMQ docs"><code>connection_name</code></a>.</p><p>This is how it looks like in Go:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>config <span style=color:#666>:=</span> amqp.Config{
    Properties: amqp.Table{
        <span style=color:#4070a0>&#34;connection_name&#34;</span>: <span style=color:#4070a0>&#34;currency-conversion-app&#34;</span>,
    },
}
client, err <span style=color:#666>:=</span> amqp.<span style=color:#06287e>DialConfig</span>(<span style=color:#4070a0>&#34;amqp://guest:guest@127.0.0.1:5672/&#34;</span>, config)
</code></pre></div><p>In the UI of Rabbit under the Connection tab, you can see all connected clients, including their names:</p><figure><img src=https://andygrunwald.com/img/posts/your-database-connection-deserves-a-name/rabbitmq-connection-client-name.png alt="RabbitMQ Connections: Showing clients name under the IP address"><figcaption><p>RabbitMQ Connections: Showing clients name under the IP address</p></figcaption></figure><p>➡️ Checkout <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/tree/main/rabbitmq>screenshots and code examples for RabbitMQ at Github</a>.</p><h3 id=how-to-assign-a-name-to-your-_http_-connection>How to assign a name to your <em>HTTP</em> connection</h3><p>The <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent title="User-Agent at Mozilla Developer Network">User-Agent HTTP header field</a> was explicitly created for this use-case:</p><blockquote><p>[&mldr;] string that lets servers and network peers identify the application, operating system, vendor, and/or version [&mldr;]</p></blockquote><p>How the value looks is not specified.
Here are a few suggestions:</p><ul><li><a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent title="User-Agent at Mozilla Developer Network">Mozilla Developer Network</a>: <code>&lt;product> / &lt;product-version> &lt;comment></code></li><li><a href=https://www.mediawiki.org/wiki/API:Etiquette#The_User-Agent_header title="API:Etiquette of MediaWiki">MediaWiki</a>: <code>clientname/version (contact information e.g. username, email)</code></li><li><a href=https://docs.github.com/en/rest/overview/resources-in-the-rest-api#user-agent-required title="User-Agent section @ GitHub API docs">GitHub API</a>: your GitHub username, or the name of your application</li></ul><p>➡️ Checkout <a href=https://github.com/andygrunwald/your-connection-deserves-a-name/tree/main/http>screenshots and code examples for HTTP at Github</a>.</p><h2 id=you-know-a-system-that-supports-connection-naming>You know a system that supports connection naming?</h2><p>I would love to hear from you.
Contribute to <a href=https://github.com/andygrunwald/your-connection-deserves-a-name>andygrunwald/your-connection-deserves-a-name @ GitHub</a> via an Issue or Pull Request.</p></section></article><div class="comments related-posts"><h3>Continue reading</h3><ul><li><a href=https://andygrunwald.com/blog/migrate-your-local-php-7.2-setup-to-homebrew-v1.5./>Migrate your local PHP 7.2 setup to Homebrew v1.5.*</a></li><li><a href=https://andygrunwald.com/blog/resources-to-learn-golang/>Resources to learn Go(lang)</a></li><li><a href=https://andygrunwald.com/blog/learn-redis-the-hard-way-in-production-trivago-techblog/>Learn Redis the hard way (in production) @ trivago techblog</a></li></ul></div></div><footer class=site-footer><p class=text>&copy; 2022 - Andy Grunwald</p></footer><script type=application/javascript>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes",GA_SESSION_STORAGE_KEY;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),window.sessionStorage&&(GA_SESSION_STORAGE_KEY='ga:clientId',ga('create','UA-64342623-1',{storage:'none',clientId:sessionStorage.getItem(GA_SESSION_STORAGE_KEY)}),ga(function(a){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,a.get('clientId'))})),ga('set','anonymizeIp',!0),ga('send','pageview'))</script></body></html>